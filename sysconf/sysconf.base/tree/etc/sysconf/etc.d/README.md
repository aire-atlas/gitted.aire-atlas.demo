# sysconf-etc.d: a manager for the ```conf.d``` pattern

## Splitting ```config``` into ```config.d/*.config```

The ```conf.d``` pattern, widely used on the *Debian GNU/Linux*
distribution among others, is about turning a configuration **file**
(like ```conf```) into a **directory** (like ```conf.d```) where the config lies into
multiple files.

Where the pattern is enabled, it is easy to have sysconf-managed
files, for example: ```/etc/nginx/sites-available/```,
```/etc/logrotate.d/```, etc.

But there are programs distributed with a unique config file:

* some allow include directives with wildcards: it is the case of
```/etc/network/interfaces``` to which we can add: ```source
/etc/network/interfaces.d/*.interfaces```;

* some allow include directives without wildcard: it is the case of
  ```/etc/gitconfig``` where included files need to be listed
  explicitely under the ```[include]``` section;

* some do not allow any includes anyway: it is the case of
  ```/etc/hosts``` which need to be updated in place with the
  concatenation of ```/etc/hosts/*.hosts```.


Once the mecanism is enabled for a particular file (for example,
```/etc/hosts```), every Sysconf profile can take advantage of it by
providing its specific config (```/etc/hosts/profile-a.hosts``` for
example) in a clean and non-obstrusive way.

This is why Sysconf provides
[sysconf-etc.d](../tree/usr/bin/sysconf-etc.d), a generic tool that fix
the required config files, which are by default:

* ```/etc/hosts``` out of ```/etc/hosts/*.hosts```
* ```/etc/ssh/ssh_config``` out of ```/etc/ssh/ssh_config.d/*.ssh_config```
* ```/etc/ssh/sshd_config``` out of ```/etc/ssh/sshd_config.d/*.sshd_config```
* ```/etc/gitconfig``` out of ```/etc/gitconfig.d/*.gitconfig```

Other files can be acted upon, when specified through a
```.meta.conf``` file in ```/etc/sysconf/etc.d```: see
[etc/sysconf/etc.d/README.md](../tree/etc/sysconf/etc.d) for more
information.


## Example

Suppose you have 2 files:

**/etc/gitconfig.d/alias.gitconfig**:
```
[alias]
  st = status
  ci = commit
```

**/etc/gitconfig.d/colors.gitconfig**:
```
[color]
  ui = auto
[color "branch"]
  current = yellow reverse
  local = yellow
  remote = green
```

If you define the following *meta conf* that explains how
```/etc/gitconfig``` should be generated,

**/etc/sysconf/etc.d/gitconfig.meta.conf**:
```
SYSCONF_ETC_CONFIG_TARGET_CONF=/etc/gitconfig
SYSCONF_ETC_CONFIG_TYPE=reference
SYSCONF_ETC_CONFIG_BEGIN="[include]"
SYSCONF_ETC_CONFIG_EXPRESSION="  path = "
```

... then you can run [sysconf-etc.d](../../../usr/bin/sysconf-etc.d)]:
```
sysconf-etc.d update gitconfig
```

And it will generate this following **```/etc/gitconfig```**:
```
# GENERATED BY sysconf-etc.d

[include]
  path = /etc/gitconfig.d/colors.gitconfig
  path = /etc/gitconfig.d/alias.gitconfig
```
